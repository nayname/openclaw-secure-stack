# Installation Verification Checklist

Use this checklist after running `install-native.sh` to verify your OpenClaw Secure Stack deployment.

## 1. System Users

```bash
# Verify openclaw user exists
id openclaw
# Expected: uid=XXX(openclaw) gid=XXX(openclaw) groups=XXX(openclaw)

# Verify ocproxy user exists
id ocproxy
# Expected: uid=XXX(ocproxy) gid=XXX(ocproxy) groups=XXX(ocproxy)
```

- [ ] `openclaw` user exists
- [ ] `ocproxy` user exists

## 2. Directory Structure

```bash
# SSD directories
ls -ld /opt/openclaw-secure-stack
ls -ld /opt/openclaw
ls -ld /var/lib/openclaw
ls -ld /var/lib/openclaw-proxy
ls -ld /etc/openclaw-secure-stack

# HDD directories
ls -ld /mnt/data/openclaw-audit
ls -ld /mnt/data/backups
```

- [ ] `/opt/openclaw-secure-stack` exists (root:root)
- [ ] `/opt/openclaw` exists (root:root)
- [ ] `/var/lib/openclaw` exists (openclaw:openclaw)
- [ ] `/var/lib/openclaw-proxy` exists (ocproxy:ocproxy)
- [ ] `/etc/openclaw-secure-stack` exists
- [ ] `/mnt/data/openclaw-audit` exists (ocproxy:ocproxy)
- [ ] `/mnt/data/backups` exists (root:root)

## 3. Environment Files

```bash
ls -l /etc/openclaw-secure-stack/openclaw.env
ls -l /etc/openclaw-secure-stack/proxy.env
```

- [ ] `openclaw.env` exists (root:openclaw, mode 0640)
- [ ] `proxy.env` exists (root:ocproxy, mode 0640)
- [ ] Both files contain tokens (not empty)

## 4. systemd Units

```bash
systemctl list-unit-files | grep openclaw
systemctl list-unit-files | grep caddy
```

- [ ] `openclaw.service` is enabled
- [ ] `openclaw-proxy.service` is enabled
- [ ] `caddy.service` is enabled

## 5. Services Running

```bash
systemctl is-active openclaw
systemctl is-active openclaw-proxy
systemctl is-active caddy
```

- [ ] `openclaw` is active
- [ ] `openclaw-proxy` is active
- [ ] `caddy` is active

## 6. HTTP Endpoints

```bash
curl -sf http://127.0.0.1:3000/health && echo "OpenClaw OK"
curl -sf http://127.0.0.1:8080/health && echo "Proxy OK"
curl -sfk https://localhost/health && echo "Caddy OK"
```

- [ ] OpenClaw responds at :3000
- [ ] Proxy responds at :8080
- [ ] Caddy responds at :443

## 7. Network Binding

```bash
sudo ss -tlnp | grep :3000  # Should bind to 127.0.0.1
sudo ss -tlnp | grep :8080  # Should bind to 127.0.0.1
sudo ss -tlnp | grep :443   # Should bind to 0.0.0.0
```

- [ ] OpenClaw binds to 127.0.0.1:3000 (not externally accessible)
- [ ] Proxy binds to 127.0.0.1:8080 (not externally accessible)
- [ ] Caddy binds to 0.0.0.0:443 (externally accessible)

## 8. Firewall

```bash
sudo ufw status verbose
```

- [ ] UFW is active
- [ ] SSH is allowed
- [ ] 80/tcp is allowed
- [ ] 443/tcp is allowed
- [ ] Default incoming is DENY

## 9. Database Files

```bash
ls -l /var/lib/openclaw-proxy/*.db
```

- [ ] `governance.db` exists
- [ ] `quarantine.db` exists
- [ ] `replay.db` exists

## 10. OpenClaw Config

```bash
sudo -u openclaw cat /var/lib/openclaw/.openclaw/openclaw.json | jq .gateway.trustedProxies
sudo -u openclaw cat /var/lib/openclaw/.openclaw/openclaw.json | jq .plugins
```

- [ ] `trustedProxies` is `["127.0.0.1/32"]`
- [ ] `plugins` includes `prompt-guard`
- [ ] HTTP chat completions endpoint is enabled

## 11. Audit Logging

```bash
ls -l /mnt/data/openclaw-audit/audit.jsonl
```

- [ ] `audit.jsonl` exists (will be empty until first request)

## 12. Operational Scripts

```bash
ls -l /etc/cron.daily/openclaw-backup
ls -l /usr/local/bin/openclaw-health-check
```

- [ ] Backup script installed and executable
- [ ] Health check script installed and executable

## 13. Full Health Check

```bash
/usr/local/bin/openclaw-health-check
```

- [ ] All checks pass

## 14. API Test

```bash
TOKEN=$(sudo grep OPENCLAW_TOKEN /etc/openclaw-secure-stack/proxy.env | cut -d= -f2)

curl -X POST https://localhost/v1/chat/completions \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"model": "gpt-4o-mini", "messages": [{"role": "user", "content": "Say hello"}]}' \
  | jq .
```

- [ ] API responds with chat completion
- [ ] No errors in response

## 15. Logs

```bash
sudo journalctl -u openclaw -n 50 --no-pager | grep -i error
sudo journalctl -u openclaw-proxy -n 50 --no-pager | grep -i error
sudo journalctl -u caddy -n 50 --no-pager | grep -i error
```

- [ ] No critical errors in openclaw logs
- [ ] No critical errors in proxy logs
- [ ] No critical errors in caddy logs

## 16. Resource Usage

```bash
free -h
systemctl show -p MemoryCurrent openclaw
systemctl show -p MemoryCurrent openclaw-proxy
```

- [ ] System has at least 500MB available memory
- [ ] OpenClaw is under MemoryMax (3G)
- [ ] Proxy is under MemoryMax (2G)

## Summary

**Total checks:** 16 sections, ~50 individual items

If all checks pass, your OpenClaw Secure Stack native deployment is fully operational! ðŸŽ‰

## Troubleshooting

If any check fails:

1. **Review logs:** `sudo journalctl -u <service> -n 100 --no-pager`
2. **Check install log:** Review terminal output from `install-native.sh`
3. **Re-run specific phase:** Extract relevant function from installer and run manually
4. **Consult documentation:** See `DEPLOYMENT.md` troubleshooting section
5. **Report issue:** Include output from this checklist + logs

## Automated Check

Run this one-liner to execute all checks:

```bash
/usr/local/bin/openclaw-health-check && \
  curl -sf http://127.0.0.1:3000/health >/dev/null && \
  curl -sf http://127.0.0.1:8080/health >/dev/null && \
  curl -sfk https://localhost/health >/dev/null && \
  echo "âœ“ All automated checks passed"
```
